<!-- prettier-ignore -->
{{- /*
  schema/base.html (partial): Builds and appends the appropriate schema.org.

  Initializes base schema structure and loads the appropriate schema partial 
  based on the current page type and layout. 
  It appends both the main schema and breadcrumbs.

  Dependencies: 
  - partial "head/seo/schema/home.html"
  - partial "head/seo/schema/section.html"
  - partial "head/seo/schema/content.html"
  - partial "head/seo/schema/utility.html"
  - partial "head/seo/schema/breadcrumbs.html" 

  Repo: https://github.com/oxypteros/alpha
*/ -}}
{{- /* Initialize base schema */ -}}
{{- $schemaBase := dict "@context" "https://schema.org" -}}

{{- /* Get common variables */ -}}
{{- $dateMachine := .Date.Format "2006-01-02T15:04:05-07:00" -}}
{{- $modDateMachine := .Lastmod.Format "2006-01-02T15:04:05-07:00" -}}
{{- $description := or .Page.Params.seo_description .Page.Params.description .Summary | plainify | strings.TrimSpace -}}

{{- /* Publisher data */ -}}
{{- $publisherData := dict -}}
{{- with or .Page.Params.author .Site.Params.author -}}
  {{- $publisherData = dict "@type" "Person" "name" . -}}
  {{- with $.Site.BaseURL -}}
    {{- $publisherData = merge $publisherData (dict "url" .) -}}
  {{- end -}}
{{- end -}}

{{- /* Call appropriate schema partial */ -}}
{{- $specificSchema := dict -}}
{{- if .IsHome -}}
  {{- $specificSchema = partial "head/seo/schema/home.html" (dict 
      "Page" .
      "Description" $description
      "Publisher" $publisherData
      "DateMachine" $dateMachine
      "ModDateMachine" $modDateMachine
    ) -}}
{{- else if .IsSection -}}
  {{- $specificSchema = partial "head/seo/schema/section.html" (dict 
      "Page" .
      "Description" $description
      "Publisher" $publisherData
      "DateMachine" $dateMachine
      "ModDateMachine" $modDateMachine
    ) -}}
{{- else if in (slice "page" "story") .Layout -}}
  {{- $specificSchema = partial "head/seo/schema/content.html" (dict 
      "Page" .
      "Description" $description
      "Publisher" $publisherData
      "DateMachine" $dateMachine
      "ModDateMachine" $modDateMachine
    ) -}}
{{- else if eq .Layout "utility" -}}
  {{- $specificSchema = partial "head/seo/schema/utility.html" (dict 
      "Page" .
      "Description" $description
      "DateMachine" $dateMachine
      "ModDateMachine" $modDateMachine
    ) -}}
{{- end -}}

{{- /* Output Main Schema */ -}}
{{- if gt (len $specificSchema) 0 -}}
  {{- $schema := merge $schemaBase $specificSchema -}}
  <script type="application/ld+json">{{- $schema | jsonify | safeJS -}}</script>
{{- end -}}

{{- /* Output Breadcrumbs */ -}}
{{- if and (not .IsHome) (.Parent) -}}
  {{- partial "head/seo/schema/breadcrumbs.html" . -}}
{{- end -}}