{{- /* OCD Self Check */}}
{{- $ocdSelfCheck := true -}}
{{- $title := printf "Initialization Failed" -}}
{{- $code := "" -}}
{{- $reason := printf "Critical asset is missing" -}}
{{- $path := "" -}}
{{- $file := "" -}}
{{- $solution := "" -}}
{{- $repoURL := "" -}}

{{- /* Head css/js files check */}}
{{- $ocdSelfCheckHeadpage := .Store.Get "ocdSelfCheckHeadpage" | default (slice) -}}
{{- if gt (len $ocdSelfCheckHeadpage) 0 -}}
  {{- range $ocdSelfCheckHeadpage -}}
    {{- $ocdSelfCheck = false -}}

    {{- $code = .code -}}
    {{- $file = .file -}}
    {{- $path = .path -}}

    {{- if eq $code "ocd-file-101" }}
      {{- $repoURL = "https://github.com/oxypteros/alpha/blob/main/assets/alpha/ocd/css" -}}
    {{- else if eq $code "ocd-file-102" }}
      {{- $repoURL = "https://github.com/oxypteros/alpha/blob/main/assets/alpha/ocd/js" -}}
    {{- else }}
      {{- $repoURL = "https://github.com/oxypteros/alpha/" -}}
    {{- end }}

    {{- $solution = printf "OCD UI has been automatically disabled.\n\nTo restore functionality, please add the original\n'%s' file from the theme repository:\n\n%s" $file $repoURL -}}
  {{- end -}}
{{- end }}
{{- /* Missing i18n file check */}}
{{- if not (i18n "OcdI18nSelfCheck") -}}
  {{- $ocdSelfCheck = false -}}

  {{- $code = "ocd-file-103" -}}
  {{- $reason = printf "Critical asset or i18n value is missing" -}}
  {{- $file = printf "en_ocd.toml" -}}
  {{- $path = printf "i18n/en_ocd.toml" }}
  {{- $repoURL = "https://github.com/oxypteros/alpha/blob/main/i18n/en_ocd.toml" }}
  {{- $solution = printf "OCD UI has been automatically disabled.\n\nTo restore functionality, please add the original\n'%s' file from the theme repository:\n\n%s" $file $repoURL -}}
{{- end }}

{{- /* Missing page data markdown check */}}
{{- if not site.Data.ocd.page.markdown -}}
  {{- $ocdSelfCheck = false -}}

  {{- $code = "ocd-file-104" -}}
  {{- $file = printf "markdown.toml" -}}
  {{- $path = printf "data/ocd/page/markdown.toml" }}
  {{- $repoURL = "https://github.com/oxypteros/alpha/blob/main/data/ocd/page/markdown.toml" }}
  {{- $solution = printf "OCD UI has been automatically disabled.\n\nTo restore functionality, please add the original\n'%s' file from the theme repository:\n\n%s" $file $repoURL -}}
{{- end }}

{{- /* Missing page data config check */}}
{{- if not site.Data.ocd.page.config -}}
  {{- $ocdSelfCheck = false -}}

  {{- $code = "ocd-file-105" -}}
  {{- $file = printf "config.toml" -}}
  {{- $path = printf "data/ocd/page/config.toml" }}
  {{- $repoURL = "https://github.com/oxypteros/alpha/blob/main/data/ocd/page/config.toml" }}
  {{- $solution = printf "OCD UI has been automatically disabled.\n\nTo restore functionality, please add the original\n'%s' file from the theme repository:\n\n%s" $file $repoURL -}}
{{- end }}

{{- /* Missing page data frontmatter check */}}
{{- if not site.Data.ocd.page.frontmatter -}}
  {{- $ocdSelfCheck = false -}}

  {{- $code = "ocd-file-106" -}}
  {{- $file = printf "frontmatter.toml" -}}
  {{- $path = printf "data/ocd/page/frontmatter.toml" }}
  {{- $repoURL = "https://github.com/oxypteros/alpha/blob/main/data/ocd/page/frontmatter.toml" }}
  {{- $solution = printf "OCD UI has been automatically disabled.\n\nTo restore functionality, please add the original\n'%s' file from the theme repository:\n\n%s" $file $repoURL -}}
{{- end }}


{{- /* Missing console data config check */}}
{{- if not site.Data.ocd.console.config -}}
  {{- $ocdSelfCheck = false -}}

  {{- $code = "ocd-file-120" -}}
  {{- $file = printf "config.toml" -}}
  {{- $path = printf "data/ocd/console/" }}
  {{- $repoURL = "https://github.com/oxypteros/alpha/blob/main/data/ocd/console/config.toml" }}
  {{- $solution = printf "OCD UI has been automatically disabled.\n\nTo restore functionality, please add the original\n'%s' file from the theme repository:\n\n%s" $file $repoURL -}}
{{- end }}

{{- /* Show ocdWarn self check results */}}
{{- if not $ocdSelfCheck }}
<!-- prettier-ignore -->
{{- warnf `
[OCD] %s
─────────────────────────────────────────────────
Code   : %s
Reason : %s
File   : %s
Path   : %s
─────────────────────────────────────────────────
%s
─────────────────────────────────────────────────`
$title
$code
$reason
$file
$path
$solution
-}}
{{- end }}
{{- /* Disable OCD UI */}}
{{- return $ocdSelfCheck -}}
