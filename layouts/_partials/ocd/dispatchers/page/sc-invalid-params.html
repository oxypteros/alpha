{{- /*
  Partial: ocd/dispatchers/page/sc-invalid-params.html
  Purpose: Renders the page errors for invalid parameters in shortcodes.

  Repo: https://github.com/oxypteros/alpha
*/}}

{{- /*
  Dictionary keys from the handler originated by:
  'ocd/core/shortcodes/validator.logic.html'
  'data/shortcodes/rules.toml'
*/}}
{{- $code := .code -}}
{{- $scName := .scName -}}
{{- $invalidParams := .invalidParams -}}
{{- $validParams := .validParams -}}

{{- /* Input data from 'data/ocd/page/shortcodes.toml' */}}
{{- $scErrorDefs := site.Data.ocd.page.shortcodes -}}

{{- /* Get shortcode error values from data for page */}}
{{- $entry := (index $scErrorDefs $code) | default dict -}}

{{- /* Define severity for page (css) */}}
{{- $severity := $entry.severity | default "warning" -}}
{{- $severityClass := cond (eq $severity "error") "ocd-card-error" "ocd-card-warning" -}}
{{- $ocdIcon := cond (eq $severity "error") "#ocd-error-icon" "#ocd-warning-icon" -}}

{{- /* Format values for default use */}}
{{- $docURL := $entry.docURL | default "https://alpha.oxypteros.com/docs/" | safeHTML -}}

{{- /* - Separate invalid params from values */}}
{{- $invalidKeys := slice -}}
{{- range $k, $_ := .invalidParams }}
  {{- $invalidKeys = $invalidKeys | append $k }}
{{- end }}
{{- /* - Format params for use */}}
{{- $formattedInvalid := delimit (sort $invalidKeys) ", " -}}
{{- $formattedValid := delimit $validParams ", " -}}

{{- /* - Count for i18n pluralization */}}
{{- $countInvalid := len $invalidParams -}}
{{- $countValid := len $validParams -}}


<div class="ocd ocd-card {{ $severityClass }} ocd-shadow">
  <header class="ocd-card-header">
    <h2 class="ocd-title">
      {{- i18n "OcdScParamError" $countInvalid | default "Shortcode Parameter Error" }}
    </h2>
    <svg aria-hidden="true" focusable="false" width="24" height="24">
      <use href="{{- $ocdIcon -}}"></use>
    </svg>
  </header>
  <div class="ocd-card-content">
    <div class="ocd-card-content-reason">
      <p>
        {{- i18n "OcdScInvParam" $countInvalid | default "Invalid parameter used in the shortcode:" }}
        <span class="ocd-mono ocd-mono-error"
          >&lbrace;&lbrace;&lt; {{ $scName }} &gt;&rbrace;&rbrace;</span
        >.
      </p>
      <p>
        {{- i18n "OcdScParameter" $countInvalid | default "The parameters," }}&nbsp;
        <span class="ocd-mono ocd-mono-error">{{ $formattedInvalid }}</span
        >&nbsp;
        {{ i18n "OcdScNotRecognized" $countInvalid | default "are not recognized." }}
      </p>
    </div>
    <hr />
    <div class="ocd-card-content-solution">
      <p>
        {{ i18n "OcdScValidParameters" $countValid | default "Valid parameters:" }}
        <span class="ocd-mono ocd-mono-solution">{{ $formattedValid }}</span>
      </p>
    </div>
  </div>
  <footer class="ocd-card-footer">
    <div class="ocd-card-footer-meta">
      <p class="ocd-mono">
        <strong>{{ i18n "OcdCardInput" . | default "Input:" }}</strong>
        {{- /* Render pair invalid param and value */}}
        {{- $total := len $invalidParams -}}
        {{- $i := 0 -}}
        {{- range $invalidParam, $invalidValue := $invalidParams }}
          <span class="ocd-mono ocd-mono-error">{{ $invalidParam }}</span
          ><span class="ocd-mono">="{{ $invalidValue }}"</span>
          {{- $i = add $i 1 -}}
          {{- if lt $i $total }}<span class="ocd-mono">, </span>{{ end -}}
        {{- end -}}
      </p>
      {{- with $docURL }}
        <a class="ocd-mono" href="{{ $docURL }}">{{ $code }}</a>
      {{- end }}
    </div>
  </footer>
</div>
