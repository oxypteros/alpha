{{- /*
  Partial: ocd/dispatchers/page/config.html
  Purpose: Renders the page warnings for config errors.

    Repo: https://github.com/oxypteros/alpha
*/}}
{{- /* Input data from core/config/handler.logic */}}
{{- $cfgErrors := .configErrors -}}

{{- /* Input data from 'data/ocd/page/config.toml' */}}
{{- $cfgErrorDefs := site.Data.ocd.page.config -}}

{{- range first 1 $cfgErrors -}}
  {{- /*
    Dictionary keys provided by the partials:
    'ocd/core/config/check.logic.html'
    'head/seo/images.html'
  */}}
  {{- $code := .code | default "ocd-cfg-000" -}}
  {{- $lang := .lang -}}
  {{- $keyValue := .keyValue -}}
  {{- $path := .path -}}
  {{- $currentYear := .currentYear -}}

  {{- /* Get config error values from data */}}
  {{- $entry := (index $cfgErrorDefs $code) | default dict -}}

  {{- /* Define severity for page card (css) */}}
  {{- $severity := $entry.severity | default "warning" -}}
  {{- $severityClass := cond (eq $severity "error") "ocd-card-error" "ocd-card-warning" -}}
  {{- $ocdIcon := cond (eq $severity "error") "#ocd-error-icon" "#ocd-warning-icon" -}}

  {{- /* Format values for default use */}}
  {{- $titleKey := $entry.title | default "OcdUnknownTitle" -}}
  {{- $title := i18n $titleKey | safeHTML -}}

  {{- $key := $entry.key -}}

  {{- $file := $entry.file -}}

  {{- $reasonKey := $entry.reason | default "OcdUnknownReason" -}}
  {{- $reason := i18n $reasonKey | safeHTML -}}

  {{- $solutionKey := $entry.solution | default "OcdUnknownSolution" -}}
  {{- $solution := i18n $solutionKey | safeHTML -}}

  {{- $preExample := i18n ($entry.preExample | default "") | safeHTML -}}
  {{- $example := i18n ($entry.example | default "OcdUnknownExample") | safeHTML -}}

  {{- $docURL := $entry.docURL | default "https://alpha.oxypteros.com/docs/" | safeHTML -}}

  {{- /*
    hugo.toml: Missing .Site.Title
    Code: ocd-cfg-102
  */}}
  {{- if eq $code "ocd-cfg-102" -}}
    {{- $reason = printf (i18n $reasonKey) $key $file | safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key $file | safeHTML -}}

    {{- /*
      languages.toml: Missing Lang weight
      Codes: ocd-cfg-112
    */}}
  {{- else if eq $code "ocd-cfg-112" -}}
    {{- $reason = printf (i18n $reasonKey) $key $lang | safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key $lang| safeHTML -}}

    {{- /*
      languages.toml: Missing languageName
      Codes: ocd-cfg-113
    */}}
  {{- else if eq $code "ocd-cfg-113" -}}
    {{- $reason = printf (i18n $reasonKey) $key $lang | safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key $lang| safeHTML -}}

    {{- /*
      params.toml: Invalid established_year
      Codes: ocd-cfg-121
    */}}
  {{- else if eq $code "ocd-cfg-121" -}}
    {{- $reason = printf (i18n $reasonKey) $key $keyValue| safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key | safeHTML -}}
    {{- $example = printf (i18n $entry.example ) $currentYear | safeHTML -}}

    {{- /*
      params.toml: Future established_year
      Codes: ocd-cfg-122
    */}}
  {{- else if eq $code "ocd-cfg-122" -}}
    {{- $reason = printf (i18n $reasonKey) $key $keyValue| safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key | safeHTML -}}
    {{- $example = printf (i18n $entry.example ) $currentYear | safeHTML -}}

    {{- /*
      params.toml: Missing SEO image seo_default_image
      Codes: ocd-cfg-132
    */}}
  {{- else if eq $code "ocd-cfg-132" -}}
    {{- $reason = printf (i18n $reasonKey) $keyValue $file | safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $path | safeHTML -}}
    {{- $example = printf (i18n $entry.example )  $key $keyValue | safeHTML -}}

    {{- /*
      params.toml: Bad quality SEO image seo_default_image
      Codes: ocd-cfg-132
    */}}
  {{- else if eq $code "ocd-cfg-133" -}}
    {{- $reason = printf (i18n $reasonKey) $keyValue $file | safeHTML -}}
    {{- $example = printf (i18n $entry.example )  $key $keyValue | safeHTML -}}

    {{- /*
      Fallback for missing or undefined code
      Code: ocd-cfg-000 or undefined
    */}}
  {{- else }}
   {{- $reason = printf (i18n $reasonKey)  | safeHTML -}}
  {{- end }}

  <div class="ocd ocd-card-container">
    <div class="ocd ocd-card {{ $severityClass }} ocd-shadow">
      <header class="ocd-card-header">
        <h2 class="ocd-title">{{- with $title }}{{ . }}{{- end }}</h2>
        <svg aria-hidden="true" focusable="false" width="24" height="24">
          <use href="{{- $ocdIcon -}}"></use>
        </svg>
      </header>

      <div class="ocd-card-content">
        <div class="ocd-card-content-reason">{{- with $reason }}{{ . }}{{- end }}</div>
        <hr />
        <div class="ocd-card-content-solution">{{- with $solution }}{{ . }}{{- end }}</div>
      </div>

      <footer class="ocd-card-footer">
        <div class="ocd-card-footer-meta">
          <p>
            {{ with $preExample }}
              <strong>{{ . }}</strong>
            {{- end }}
            {{ with $example }}{{ . | safeHTML }}{{- end }}
          </p>
          <a
            class="ocd-mono"
            href="{{ $docURL }}"
            target="_blank"
            rel="noopener noreferrer"
            >{{ $code }}</a
          >
        </div>
      </footer>
    </div>
  </div>
{{- end -}}
