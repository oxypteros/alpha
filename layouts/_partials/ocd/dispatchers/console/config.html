{{- /*
  Partial: ocd/dispatchers/console/config.html
  Purpose: Renders the console warnings for config errors.
*/}}

{{- /* Input data from core/config/handler.logic */}}
{{- $cfgErrors := .configErrors -}}

{{- /* Input data from 'data/ocd/console/config.toml' */}}
{{- $cfgErrorDefs := site.Data.ocd.console.config -}}

{{- range $cfgErrors -}}
  {{- /*
    Dictionary keys provided by the partials:
    'ocd/core/config/check.logic.html'
    'head/seo/images.html'
  */}}
  {{- $code := .code | default "ocd-cfg-000" -}}
  {{- $path := .path -}}
  {{- $keyValue := .keyValue -}}
  {{- $lang := .lang -}}
  {{- $currentYear := .currentYear -}}

  {{- /* Get config error values from data */}}
  {{- $entry := (index $cfgErrorDefs $code) | default dict -}}

  {{- /* Define severity for page card (css) */}}
  {{- $severity := $entry.severity | default "warning" -}}
  {{- $severityClass := cond (eq $severity "error") "ocd-console-error" "ocd-console-warning" -}}

  {{- /* Format values for default use */}}
  {{- $titleKey := $entry.title | default "OcdUnknownTitle" -}}
  {{- $title := i18n $titleKey | safeHTML -}}

  {{- $key := $entry.key -}}

  {{- $file := $entry.file -}}

  {{- $reasonKey := $entry.reason | default "OcdUnknownReason" -}}
  {{- $reason := i18n $reasonKey | safeHTML -}}

  {{- $solutionKey := $entry.solution | default "OcdUnknownSolution" -}}
  {{- $solution := i18n $solutionKey | safeHTML -}}

  {{- $preExample := i18n ($entry.preExample | default "Example:") | safeHTML -}}
  {{- $example := i18n ($entry.example | default "OcdUnknownExample") | safeHTML -}}

  {{- $docURL := $entry.docURL | default "https://alpha.oxypteros.com/docs/" | safeHTML -}}
  {{- $preDoc := $entry.preDoc | default "" -}}

  {{- /*
    hugo.toml: Missing .Site.Title
    Code: ocd-cfg-102
  */}}
  {{- if eq $code "ocd-cfg-102" -}}
    {{- $reason = printf (i18n $reasonKey) $key $file | safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key $file | safeHTML -}}
    {{- $example = printf (i18n $entry.example) $file | safeHTML -}}

    {{- /*
      languages.toml: Missing Lang weight
      Codes: ocd-cfg-112
    */}}
  {{- else if eq $code "ocd-cfg-112" -}}
    {{- $reason = printf (i18n $reasonKey) $key $lang | safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key $lang $file | safeHTML -}}
    {{- $example = printf (i18n $entry.example) $file $lang | safeHTML -}}
    {{- /*
      languages.toml: Missing languageName
      Codes: ocd-cfg-113
    */}}
  {{- else if eq $code "ocd-cfg-113" -}}
    {{- $reason = printf (i18n $reasonKey) $key $lang | safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key $lang $file | safeHTML -}}
    {{- $example = printf (i18n $entry.example) $file $key | safeHTML -}}

    {{- /*
      params.toml: Invalid established_year
      Codes: ocd-cfg-121
    */}}
  {{- else if eq $code "ocd-cfg-121" -}}
    {{- $reason = printf (i18n $reasonKey) $key $keyValue| safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key $file| safeHTML -}}
    {{- $example = printf (i18n $entry.example ) $file $key $currentYear | safeHTML -}}

    {{- /*
      params.toml: Future established_year
      Codes: ocd-cfg-122
    */}}
  {{- else if eq $code "ocd-cfg-122" -}}
    {{- $reason = printf (i18n $reasonKey) $key $keyValue| safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $key $file | safeHTML -}}
    {{- $example = printf (i18n $entry.example ) $file $key $currentYear | safeHTML -}}

    {{- /*
      params.toml: Missing SEO image seo_default_image
      Codes: ocd-cfg-132
    */}}
  {{- else if eq $code "ocd-cfg-132" -}}
    {{- $reason = printf (i18n $reasonKey) $keyValue $file | safeHTML -}}
    {{- $solution = printf (i18n $solutionKey) $path | safeHTML -}}
    {{- $example = printf (i18n $entry.example )  $file $key $keyValue | safeHTML -}}

    {{- /*
      params.toml: Bad quality SEO image seo_default_image
      Codes: ocd-cfg-132
    */}}
  {{- else if eq $code "ocd-cfg-133" -}}
    {{- $reason = printf (i18n $reasonKey) $keyValue $file | safeHTML -}}
    {{- $example = printf (i18n $entry.example )  $file $key $keyValue | safeHTML -}}

    {{- /*
      Fallback for missing or undefined code
      Code: ocd-cfg-000 or undefined
    */}}
  {{- else }}
    {{- $reason = printf (i18n $reasonKey)  | safeHTML -}}
  {{- end }}


  <div data-error="{{ $code }}"></div>
  <template data-alpha="{{ $code }}-template">
    <div class="ocd-console-explanation {{ $severityClass }}">
      {{- with $title }}
        <h2>
          {{- . -}}
        </h2>
      {{- end }}
      {{- with $reason }}
        <p>
          {{- . | safeHTML -}}
        </p>
      {{- end }}
      <br />
      {{- with $solution }}
        <div class="ocd-console-solution">
          <h3 class="ocd-console-h3">
            {{ i18n "OcdSolution" . | default "Solution:" }}
          </h3>
          <p>{{ . | safeHTML }}</p>
        </div>
      {{- end }}
      {{- with $example }}
        <div class="ocd-console-example">
          <h3>{{ $preExample }}</h3>
          <p class="ocd-mono ocd-mono-con-solution">
            {{- $example | safeHTML }}
          </p>
        </div>
      {{- end }}
    </div>
    <div class="ocd-console-doc">
      {{- if $preDoc }}
        <div class="hr hr-left"></div>
        {{- with $docURL }}
          <a href="{{ . }}"
            ><span class="ocd-mono"></span> {{ $preDoc }}
            {{ i18n "OcdDoc" . }}</a
          >
        {{- end }}
      {{- end }}
      <div class="hr hr-right"></div>
    </div>
  </template>
{{- end -}}
