{{- /*
  Partial: ocd/dispatchers/legacy/hero-sc.html
  Purpose: Render the `OCD warn`, `OCD on page`, and `OCD console` warning
  message for incomplete link/text pairs.

  Repo: https://github.com/oxypteros/alpha
*/}}

{{- $ocdWarnEnabled := .Site.Params.ocdWarn_enabled | default true -}}
{{- $ocdEnabled := and hugo.IsDevelopment (.Site.Params.ocd_enabled | default true) -}}

{{- $context := .context -}}

{{- $errorCode := .errorCode -}}
{{- $scName := .scName -}}
{{- $isBtnPairValid := .isBtnPairValid -}}
{{- $isLinkPairValid := .isLinkPairValid -}}
{{- $btnLink  := .btnLink -}}
{{- $btnTxt := .btnTxt -}}
{{- $link  := .link -}}
{{- $linkTxt := .linkTxt -}}

{{- /* - Counter for pluralization */}}
{{- $countPairs := 0 -}}

{{- if and (not $isBtnPairValid) (or $btnLink $btnTxt) -}}
  {{- $countPairs = add $countPairs 1 -}}
{{- end -}}

{{- if and (not $isLinkPairValid) (or $link $linkTxt) }}
  {{- $countPairs = add $countPairs 1 -}}
{{- end }}

{{- /* ** ocdWarn */}}
{{- if  $ocdWarnEnabled }}
  {{- /* *** ocdWarn messages */}}
  {{- $errorDetails := slice -}}

  {{- if not $isBtnPairValid | and (or $btnLink $btnTxt) }}
    {{- $detail := "The 'Button' pair is incomplete." -}}
    {{- if $btnTxt -}}
      {{- $detail = printf "The 'Button' pair is missing an URL for its text '%s'." $btnTxt -}}
    {{- else if $btnLink -}}
      {{- $detail = printf "The 'Button' pair is missing text for its URL '%s'." $btnLink -}}
    {{- end -}}
    {{- $errorDetails = $errorDetails | append $detail -}}
  {{- end -}}

  {{- if not $isLinkPairValid | and (or $link $linkTxt) }}
    {{- $detail := "The 'Link' pair is incomplete." -}}
    {{- if $linkTxt -}}
      {{- $detail = printf "The 'Link' pair is missing an URL for its text '%s'." $linkTxt -}}
    {{- else if $link -}}
      {{- $detail = printf "The 'Link' pair is missing text for its URL '%s'." $link -}}
    {{- end -}}
    {{- $errorDetails = $errorDetails | append $detail -}}
  {{- end -}}

  {{- $solution := "Provide both the URL and the text, or remove both\nattributes." }}
  {{- if gt $countPairs 1 }}
    {{- $solution = "For each link, provide both the URL and the text,\nor remove both attributes." }}
  {{- end }}
  {{- $relPosition := replaceRE `^.*?(content/.*:\d+:\d+).*$` "$1" $context.Position -}}
  {{- /* *** Final ocdWarn for terminal */}}
  <!-- prettier-ignore -->
  {{- warnf `
[OCD] Invalid Link Pair
─────────────────────────────────────────────────
Code      : %s
Shortcode : %s
Reason    : %s
Page      : %s
File      : %s
─────────────────────────────────────────────────
%s
─────────────────────────────────────────────────`
$errorCode
$scName
(delimit $errorDetails "\n            ")
$context.Page.Permalink
$relPosition
$solution
  -}}
{{- end }}

{{- if $ocdEnabled }}
  {{- /* ** OCD Page */}}
  <div
    class="ocd ocd ocd-card ocd-card-warning ocd-shadow"
    data-error="{{ $errorCode }}"
  >
    <header class="ocd-card-header">
      <h2 class="ocd-title">
        {{- i18n "OcdScPairsTitle" $countPairs | default "Incomplete Link/Text Pairs" -}}
      </h2>
      <svg aria-hidden="true" focusable="false" width="24" height="24">
        <use href="#ocd-warning-icon"></use>
      </svg>
    </header>
    <div class="ocd-card-content">
      <div>
        <p>
          {{- i18n "The" . |default "The" }}
          <span class="ocd-mono"
            >&lbrace;&lbrace;&lt; {{ $scName }} &gt;&rbrace;&rbrace;</span
          >
          {{ i18n "OcdScPairsReason" $countPairs | default "shortcode has one or more incomplete" }}
          <span class="ocd-mono"
            >{{ i18n "OcdScPairsLinkText" . | default "link/text" }}</span
          >
          {{ i18n "OcdScPairsPairs" $countPairs | default "pairs." }}<br />
          {{ i18n "OcdScPairsExplain" . | default "This will cause usability and accessibility issues." }}
        </p>
        <ul>
          {{- if not $isBtnPairValid | and (or $btnLink $btnTxt) }}
            <li>
              <strong>{{ i18n "OcdScPairsBtnPair" }}:</strong>
              {{ if $btnTxt -}}
                {{ i18n "OcdScPairsProvided" . | default "You provided" }}
                <span class="ocd-mono">BTN-TEXT="{{ $btnTxt }}"</span>
                {{- i18n "OcdScPairsMissingLink" . | default ", but the corresponding link" }}
                (<span class="ocd-mono">BTN-LINK</span>)
                {{ i18n "OcdScPairsIsMissing" . | default "is missing." }}
              {{- else -}}
                {{ i18n "OcdScPairsProvided" . | default "You provided" }}
                <span class="ocd-mono">BTN-LINK="{{ $btnLink }}"</span>
                {{- i18n "OcdScPairsMissingText" . | default ", but the corresponding text" }}
                (<span class="ocd-mono">BTN-TEXT</span>)
                {{ i18n "OcdScPairsIsMissing" . | default "is missing." }}
              {{- end -}}
            </li>
          {{- end }}
          {{- if not $isLinkPairValid | and (or $link $linkTxt) }}
            <li>
              <strong>{{ i18n "OcdScPairsLinkPair" }}:</strong>
              {{ if $linkTxt }}
                {{ i18n "OcdScPairsProvided" . | default "You provided" }}
                <span class="ocd-mono">LINK-TEXT="{{ $linkTxt }}"</span>
                {{- i18n "OcdScPairsMissingLink" . | default ", but the corresponding link" }}
                (<span class="ocd-mono">LINK</span>)
                {{ i18n "OcdScPairsIsMissing" . | default "is missing." }}
              {{- else -}}
                {{ i18n "OcdScPairsProvided" . | default "You provided" }}
                <span class="ocd-mono">LINK="{{ $link }}"</span>
                {{- i18n "OcdScPairsMissingText" . | default ", but the corresponding text" }}
                (<span class="ocd-mono">LINK-TEXT</span>)
                {{ i18n "OcdScPairsIsMissing" . | default "is missing." }}
              {{- end -}}
            </li>
          {{- end }}
        </ul>
      </div>
      <hr />
      <div class="ocd-card-content-solution">
        <p>
          <span class="ocd-mono">
            {{- i18n "OcdScPairsSolution" $countPairs | default "Provide both the URL and the text, or remove both attributes." }}</span
          >
        </p>
      </div>
    </div>
    <footer class="ocd-card-footer">
      <div class="ocd-card-footer-meta">
        <p></p>
        <a class="ocd-mono" href="https://alpha.oxypteros.com/docs/ocd"
          >{{ $errorCode }}</a
        >
      </div>
    </footer>
  </div>
  {{- /* ** OCD Console */}}
  <template data-alpha="{{ $errorCode }}-template">
    <div class="ocd-console-explanation ocd-console-warning">
      <h2>
        {{- i18n "OcdScPairsTitle" $countPairs | default "Incomplete Link/Text Pairs" -}}
      </h2>
      <p>
        {{- i18n "The" . |default "The" }}
        <span class="ocd-mono"
          >&lbrace;&lbrace;&lt; {{ $scName }} &gt;&rbrace;&rbrace;</span
        >
        {{ i18n "OcdScPairsReason" $countPairs | default "shortcode has one or more incomplete" }}
        <span class="ocd-mono"
          >{{ i18n "OcdScPairsLinkText" . | default "link/text" }}</span
        >
        {{ i18n "OcdScPairsPairs" $countPairs | default "pairs." }}
      </p>
      <p>
        {{ i18n "OcdScPairsExplain" . | default "This will cause usability and accessibility issues." }}
      </p>
      <ul>
        {{- if not $isBtnPairValid | and (or $btnLink $btnTxt) }}
          <li>
            <strong>{{ i18n "OcdScPairsBtnPair" }}:</strong>
            {{ if $btnTxt -}}
              {{ i18n "OcdScPairsProvided" . | default "You provided" }}
              <span class="ocd-mono">BTN-TEXT="{{ $btnTxt }}"</span>
              {{- i18n "OcdScPairsMissingLink" . | default ", but the corresponding link" }}
              (<span class="ocd-mono">BTN-LINK</span>)
              {{ i18n "OcdScPairsIsMissing" . | default "is missing." }}
            {{- else -}}
              {{ i18n "OcdScPairsProvided" . | default "You provided" }}
              <span class="ocd-mono">BTN-LINK="{{ $btnLink }}"</span>
              {{- i18n "OcdScPairsMissingText" . | default ", but the corresponding text" }}
              (<span class="ocd-mono">BTN-TEXT</span>)
              {{ i18n "OcdScPairsIsMissing" . | default "is missing." }}
            {{- end -}}
          </li>
        {{- end }}
        {{- if not $isLinkPairValid | and (or $link $linkTxt) }}
          <li>
            <strong>{{ i18n "OcdScPairsLinkPair" }}:</strong>
            {{ if $linkTxt }}
              {{ i18n "OcdScPairsProvided" . | default "You provided" }}
              <span class="ocd-mono">LINK-TEXT="{{ $linkTxt }}"</span>
              {{- i18n "OcdScPairsMissingLink" . | default ", but the corresponding link" }}
              (<span class="ocd-mono">LINK</span>)
              {{ i18n "OcdScPairsIsMissing" . | default "is missing." }}
            {{- else -}}
              {{ i18n "OcdScPairsProvided" . | default "You provided" }}
              <span class="ocd-mono">LINK="{{ $link }}"</span>
              {{- i18n "OcdScPairsMissingText" . | default ", but the corresponding text" }}
              (<span class="ocd-mono">LINK-TEXT</span>)
              {{ i18n "OcdScPairsIsMissing" . | default "is missing." }}
            {{- end -}}
          </li>
        {{- end }}
      </ul>
      <div class="ocd-console-example"></div>
    </div>
    <div class="ocd-console-doc">
      <div class="hr hr-right"></div>
    </div>
  </template>
{{- end }}
