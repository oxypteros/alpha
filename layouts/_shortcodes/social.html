{{- /*
  Shortcode: social.html
  Purpose: Renders a social network list with icons or text.

  Target: Global

  Example:
  { {< social LIMIT="" >} }

  Params:
  - LIMIT (integral, optional): Number of menu item to show

  Error handler:
  - ocdWarn (global)
  - OCD (scoped)

  Docs: https://alpha.oxypteros.com/shortcodes/social
  Repo: https://github.com/oxypteros/alpha
*/}}

{{- $ocdWarnEnabled := .Site.Params.ocdWarn_enabled | default true -}}
{{- $ocdEnabled := and hugo.IsDevelopment (.Site.Params.ocd_enabled | default true) -}}

{{- /* * Social Shortcode Data */}}
{{- $scName := "social" -}}
{{- /* ** Social shortcode rules */}}
{{- $rules := dict
  "validKeys" (slice "LIMIT")
  "params" (dict
  "LIMIT" (dict "validation" "is_positive_integer")
  )
-}}
{{- /* ** Social shortcode metadata */}}
{{- $errorMeta := dict
  "docURL" "https://alpha.oxypteros.com/docs/shortcodes/social"
  "example" "&lbrace;&lbrace;&lt; LIMIT=\"6\" &gt;&rbrace;&rbrace;"
  "errorCodes" (dict
  "invalidKey"   "ocd-sc-220"
  "invalidValue" "ocd-sc-221"
  "missingMenu"  "ocd-sc-228"
  )
-}}

{{- /* *  Validate shortcode input */}}
{{- $validationResult := partial "ocd/core/shortcodes/validator.logic.html" (dict "rules" $rules "userInput" .Params) -}}

{{- /* ** Conditions to render shortcode or OCD */}}
{{- /* *** Input validation */}}
{{- $validInput := $validationResult.isValid }}

{{- /* - On failed input validation call the OCD handler */}}
{{- if not $validInput }}
  {{ if or ($ocdWarnEnabled) ($ocdEnabled) }}
    {{- partial "ocd/core/shortcodes/handler.logic.html" (dict
      "scName"   .Name
      "errors"   $validationResult.errors
      "rules"    $rules
      "meta"     $errorMeta
      "page"     .Page
      "position" .Position
      )
    -}}
  {{- end }}
{{- end }}
{{- /* * On successful validations render shortcode */}}
{{- if $validInput }}
  {{- $data := $validationResult.data -}}
  {{- $menuToRender := .Site.Menus.sc_social -}}

  {{ if not $menuToRender }}
    {{- if or ($ocdWarnEnabled) ($ocdEnabled) }}
      {{- $errorData := dict
        "context"         .
        "name"            $scName
        "docURL"          $errorMeta.docURL
        "errorCode"       $errorMeta.errorCodes.missingMenu
        "scExample"       $errorMeta.example
        "menu"            "[[sc_social]]"
        "menuFile"        "config/_default/menus.toml"
      -}}
      {{- partial "ocd/dispatchers/legacy/missing-menu.html" $errorData }}
    {{- end }}
  {{- end }}

  {{- if $menuToRender }}
      {{- if $data.limit -}}
      {{- $intNumber := $data.limit -}}
      {{- $menuToRender = first $intNumber $menuToRender -}}
    {{- end -}}
    {{- /* Create unique id's for aria-labels in case of multiple shortcodes */}}
    {{- $base := .Page.File.BaseFileName | urlize }}
    {{- $ordinal := .Ordinal | default (now.UnixNano) }}
    {{- $uid := printf "%s-%v" $base $ordinal }}
    <aside
      class="sc-social mt-8 mb-32 flex w-full max-w-7xl items-center justify-center px-4"
      aria-labelledby="social-heading-{{- $uid -}}"
    >
      <h2 id="social-heading-{{- $uid -}}" class="sr-only">
        {{- i18n "SocialHeading" . | default "Social media links" }}
      </h2>
      <ul
        class="flex w-full max-w-xl flex-wrap items-center justify-center gap-3"
      >
        {{- range $menuToRender }}
          <li>
            <a
              class="group hover:text-pri dark:hover:text-pri-d flex rounded-full p-2"
              href="{{ .URL }}"
              aria-label="{{- i18n "FollowUsOn" . | default "Follow us on:"}} {{ .Name }}"
            >
              {{ with .Pre }}
                <svg
                  class="stroke-on-sur dark:stroke-on-sur-d dark:group-hover:stroke-pri-d group-hover:stroke-pri size-6"
                  aria-hidden="true"
                  width="20"
                  height="20"
                >
                  <use href="{{ . }}"></use>
                </svg>
              {{- else }}
                {{ .Name }}
              {{- end }}
            </a>
          </li>
        {{- end }}
      </ul>
    </aside>
  {{- end }}
{{- end -}}
